<script type="module">window.skybridge = { hostType: "{{hostType}}", serverUrl: "{{serverUrl}}" };</script>
<script type="module">
  import { injectIntoGlobalHook } from "{{serverUrl}}/assets/@react-refresh";
  injectIntoGlobalHook(window); window.$RefreshReg$ = () => {};
  window.$RefreshSig$ = () => (type) => type;
  window.__vite_plugin_react_preamble_installed__ = true;
</script>
<script type="module" src="{{serverUrl}}/@vite/client"></script>
{{#if useLocalNetworkAccess}}
<script type="module">
  // Checks for browser support and shows error if local network access is denied
  (async () => {
    if (!navigator.permissions?.query) {
      return;
    }

    // Skip for non-http(s) protocols (file://, custom protocols in Electron, etc.)
    const protocol = window.location.protocol;
    const isNonHttpProtocol = protocol !== 'http:' && protocol !== 'https:'
    if (isNonHttpProtocol) {
      return;
    }

    const host = window.location.hostname;
    const isLoopback = host === 'localhost'
      || /^127\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.test(host)
      || host === '::1';
    if (isLoopback) {
      return;
    }
    
    try {
      const status = await navigator.permissions.query({ name: "local-network-access" });
      if (status.state === "denied") {
        const errorDiv = document.createElement("div");
        errorDiv.style.cssText = "background: #fef2f2; border: 2px solid #ef4444; border-radius: 8px; padding: 16px; text-align: center; z-index: 10000; font-family: system-ui, sans-serif;";

        const errorTitle = document.createElement("div");
        errorTitle.style.cssText = "color: #ef4444; font-size: 18px; font-weight: 600; margin-bottom: 8px;";
        errorTitle.textContent = "Error: Local network access permission is denied.";

        const errorMessage = document.createElement("div");
        errorMessage.style.cssText = "color: #ef4444; font-size: 14px;";
        errorMessage.textContent = "Local network access is required for your widget to connect to the local dev server. Please enable it in your browser settings. ";

        const link = document.createElement("a");
        link.href = "https://developer.chrome.com/blog/local-network-access";
        link.target = "_blank";
        link.rel = "noopener noreferrer";
        link.style.cssText = "color: #ef4444; text-decoration: underline;";
        link.textContent = "Learn more";
        errorMessage.appendChild(link);

        errorDiv.appendChild(errorTitle);
        errorDiv.appendChild(errorMessage);
        document.body.appendChild(errorDiv);
      }
    } catch (e) {
      // Permission API doesn't support local-network-access, ignore silently
    }
  })();
</script>
{{/if}}
<div id="root"></div>
<script type="module" id="dev-widget-entry">
  import('{{serverUrl}}/src/widgets/{{widgetName}}');
</script>