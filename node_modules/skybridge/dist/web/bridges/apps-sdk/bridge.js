import { SET_GLOBALS_EVENT_TYPE, } from "./types.js";
export class AppsSdkBridge {
    static instance = null;
    static getInstance() {
        if (window.skybridge.hostType !== "apps-sdk" ||
            window.openai === undefined) {
            throw new Error("Apps SDK Bridge can only be used in the apps-sdk runtime");
        }
        if (AppsSdkBridge.instance === null) {
            AppsSdkBridge.instance = new AppsSdkBridge();
        }
        return AppsSdkBridge.instance;
    }
    static resetInstance() {
        if (AppsSdkBridge.instance) {
            AppsSdkBridge.instance = null;
        }
    }
    subscribe(keyOrKeys) {
        const keys = Array.isArray(keyOrKeys)
            ? keyOrKeys
            : [keyOrKeys];
        return (onChange) => {
            const handleSetGlobal = (event) => {
                const hasRelevantChange = keys.some((key) => event.detail.globals[key] !== undefined);
                if (!hasRelevantChange) {
                    return;
                }
                onChange();
            };
            window.addEventListener(SET_GLOBALS_EVENT_TYPE, handleSetGlobal, {
                passive: true,
            });
            return () => {
                window.removeEventListener(SET_GLOBALS_EVENT_TYPE, handleSetGlobal);
            };
        };
    }
    getSnapshot = (key) => {
        if (window.openai === undefined) {
            throw new Error(`window.openai is not available. Make sure you're calling the hook requiring ${key} within the OpenAI iFrame skybridge runtime.`);
        }
        return window.openai[key];
    };
}
//# sourceMappingURL=bridge.js.map