import { useCallback, useEffect, useState } from "react";
import { getAdaptor, useHostContext } from "../bridges/index.js";
import { filterWidgetContext, injectWidgetContext } from "../helpers/state.js";
export function useWidgetState(defaultState) {
    const adaptor = getAdaptor();
    const widgetStateFromBridge = useHostContext("widgetState");
    const [widgetState, _setWidgetState] = useState(() => {
        if (widgetStateFromBridge !== null) {
            return filterWidgetContext(widgetStateFromBridge);
        }
        return typeof defaultState === "function"
            ? defaultState()
            : (defaultState ?? null);
    });
    useEffect(() => {
        if (widgetStateFromBridge !== null) {
            _setWidgetState(filterWidgetContext(widgetStateFromBridge));
        }
    }, [widgetStateFromBridge]);
    const setWidgetState = useCallback((state) => {
        _setWidgetState((prevState) => {
            const newState = typeof state === "function" ? state(prevState) : state;
            const stateToSet = injectWidgetContext(newState);
            if (stateToSet !== null) {
                adaptor.setWidgetState(stateToSet);
            }
            return filterWidgetContext(stateToSet);
        });
    }, [adaptor]);
    return [widgetState, setWidgetState];
}
//# sourceMappingURL=use-widget-state.js.map