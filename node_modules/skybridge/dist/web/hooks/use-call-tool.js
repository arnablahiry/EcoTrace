import { useRef, useState } from "react";
import { getAdaptor, } from "../bridges/index.js";
export const useCallTool = (name) => {
    const [{ status, data, error }, setCallToolState] = useState({ status: "idle", data: undefined, error: undefined });
    const callIdRef = useRef(0);
    const adaptor = getAdaptor();
    const execute = async (toolArgs) => {
        const callId = ++callIdRef.current;
        setCallToolState({ status: "pending", data: undefined, error: undefined });
        try {
            const data = await adaptor.callTool(name, toolArgs);
            if (callId === callIdRef.current) {
                setCallToolState({ status: "success", data, error: undefined });
            }
            return data;
        }
        catch (error) {
            if (callId === callIdRef.current) {
                setCallToolState({ status: "error", data: undefined, error });
            }
            throw error;
        }
    };
    const callToolAsync = ((toolArgs) => {
        if (toolArgs === undefined) {
            return execute(null);
        }
        return execute(toolArgs);
    });
    const callTool = ((firstArg, sideEffects) => {
        let toolArgs;
        if (firstArg &&
            typeof firstArg === "object" &&
            ("onSuccess" in firstArg ||
                "onError" in firstArg ||
                "onSettled" in firstArg)) {
            toolArgs = null; // no toolArgs provided
            sideEffects = firstArg;
        }
        else {
            toolArgs = (firstArg === undefined ? null : firstArg);
        }
        execute(toolArgs)
            .then((data) => {
            sideEffects?.onSuccess?.(data, toolArgs);
            sideEffects?.onSettled?.(data, undefined, toolArgs);
        })
            .catch((error) => {
            sideEffects?.onError?.(error, toolArgs);
            sideEffects?.onSettled?.(undefined, error, toolArgs);
        });
    });
    const callToolState = {
        status,
        data,
        error,
        isIdle: status === "idle",
        isPending: status === "pending",
        isSuccess: status === "success",
        isError: status === "error",
    };
    return {
        ...callToolState,
        callTool,
        callToolAsync,
    };
};
//# sourceMappingURL=use-call-tool.js.map