import { create } from "zustand";
import { getAdaptor } from "./bridges/index.js";
import { getInitialState, injectWidgetContext, serializeState, } from "./helpers/state.js";
export function createStore(storeCreator, defaultState) {
    const initialState = getInitialState(defaultState);
    const store = create()((...args) => {
        const baseStore = storeCreator(...args);
        if (initialState !== null) {
            return { ...baseStore, ...initialState };
        }
        return baseStore;
    });
    store.subscribe((state) => {
        const serializedState = serializeState(state);
        if (serializedState !== null && serializedState !== undefined) {
            const stateToPersist = injectWidgetContext(serializedState);
            if (stateToPersist !== null) {
                getAdaptor().setWidgetState(stateToPersist);
            }
        }
    });
    return store;
}
//# sourceMappingURL=create-store.js.map