import superjson, {} from "superjson";
import { getAdaptor } from "../bridges/index.js";
import { WIDGET_CONTEXT_KEY } from "../data-llm.js";
export function filterWidgetContext(state) {
    if (state === null || state === undefined) {
        return null;
    }
    const { [WIDGET_CONTEXT_KEY]: _, ...filteredState } = state;
    return filteredState;
}
export function injectWidgetContext(newState) {
    if (newState === null) {
        return null;
    }
    const currentState = getAdaptor()
        .getHostContextStore("widgetState")
        .getSnapshot();
    if (currentState !== null &&
        currentState !== undefined &&
        WIDGET_CONTEXT_KEY in currentState) {
        return {
            ...newState,
            [WIDGET_CONTEXT_KEY]: currentState[WIDGET_CONTEXT_KEY],
        };
    }
    return newState;
}
export function serializeState(value) {
    return superjson.parse(superjson.stringify(value)); // Strips functions
}
export function deserializeState(value) {
    return superjson.deserialize(value);
}
export function getInitialState(defaultState) {
    const widgetState = getAdaptor()
        .getHostContextStore("widgetState")
        .getSnapshot();
    if (widgetState !== null && widgetState !== undefined) {
        return filterWidgetContext(widgetState);
    }
    return typeof defaultState === "function"
        ? defaultState()
        : (defaultState ?? null);
}
//# sourceMappingURL=state.js.map